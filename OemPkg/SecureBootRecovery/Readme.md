# Secure Boot Recovery

This application appends the Windows UEFI CA 2023 to the DB if the DB contains the Microsoft Windows Production PCA 2011

## Files

* SecureBootRecovery.c
  * Recovery Logic
* SecureBootRecovery.inf
  * Setup Information
* Payload/dbUpdate.bin
  * Raw Recovery Payload - This file is an authenticated variable with a payload to update the DB
    * Attributes:
      * NON_VOLATILE | BOOTSERVICE_ACCESS | RUNTIME_ACCESS | TIME_BASED_AUTHENTICATED_WRITE_ACCESS | APPEND_WRITE
    * Note: The signer must have it's public certificate found in the L"KEK" variable
    * Note: The payload found in this repo is the Microsoft Windows Production PCA 2011 signed Windows UEFI CA 2023 DB payload
* RecoveryPayload.h
  * The C representation of the dbUpdate.bin file auto generated by Helper.py
* Helper.py
  * Generates RecoveryPayload.h from Payload/dbUpdate.bin

## Build

```pwsh
stuart_ci_setup -c .pytool/CISettings.py BUILD_MODULE=OemPkg/SecureBootRecovery/SecureBootRecovery.inf -p OemPkg
stuart_update -c .pytool/CISettings.py BUILD_MODULE=OemPkg/SecureBootRecovery/SecureBootRecovery.inf -p OemPkg
stuart_ci_build -c .pytool/CISettings.py BUILD_MODULE=OemPkg/SecureBootRecovery/SecureBootRecovery.inf -p OemPkg
```

## Update the payload

If the recovery payload needs to be updated, replace the file `Payload/dbUpdate.bin` with a KEK signed payload.

Then execute:

```pwsh
python helper.py
```
